# glaze-manager

## 釉薬レシピ管理アプリ 仕様書 (Flutter + Firebase)

### 1. アプリ概要
個人利用を想定した、陶芸用の釉薬（うわぐすり）レシピ管理アプリケーション。
釉薬の調合情報と焼成結果（テストピース）を関連付けて管理し、オフライン環境でも利用できることを目的とする。

### 2. 動作環境・技術スタック
* **ターゲットプラットフォーム:**
    * Windows
    * macOS
    * Android
* **オフライン対応:**
    * **必須。** オフライン時にもデータの閲覧・編集が可能で、オンライン復帰時に自動同期されること。
* **技術スタック:**
    * フロントエンド (クライアント): **Flutter (Dart)**
    * バックエンド (BaaS): **Firebase**
* **コスト要件:**
    * サーバー費用を発生させず、Firebase の無料枠（Sparkプラン）での運用を前提とする。

### 3. Firebase サービス構成
* **Authentication (認証):**
    * ユーザー管理。Google アカウント等でログインし、全データをユーザーIDに紐付ける。

* **Cloud Firestore (データベース):**
    * **役割:** メインデータベース。オフライン同期機能を活用する。
    * **主要コレクション:**
        * **1. 原料 (Materials):**
            * ユーザーが管理する原料マスター。
            * 格納データ: `材料名`, `化学成分比` (SiO₂, Al₂O₃など)
        * **2. 釉薬 (Glazes):**
            * 釉薬の基本レシピ。
            * 格納データ: `釉薬名`, `調合` (Materials参照IDと配合量のマップ), `タグ` (配列)
        * **3. テストピース (TestPieces):**
            * 釉薬の焼成結果。
            * 格納データ: `釉薬ID` (Glazes参照), `焼成プロファイルID`, `焼成雰囲気ID`, `素地土ID`, `画像パス`, `色味データ` (抽出された代表色)
        * **4. 素地土 (Clays):**
            * テストピースに使用する土の種類。
        * **5. 焼成プロファイル (FiringProfiles):**
            * 焼成温度曲線データ（チャート表示用）。
        * **6. 焼成雰囲気 (FiringAtmospheres):**
            * 酸化・還元などの焼成雰囲気区分。

* **Cloud Storage (ストレージ):**
    * **役割:** `TestPieces` に紐付く、**テストピース画像**の保存場所。

---

### 4. UI/UX 設計
* **基本レイアウト:**
    * 現代風のタブレイアウトを採用。
* **ナビゲーション:**
    * 画面下部のタブバー（Bottom Navigation Bar）により、主要機能間を遷移する。
* **タブ構成:**
    1.  **テストピース** (ホーム)
    2.  **検索**
    3.  **釉薬**
    4.  **原料**
    5.  **設定**

---

### 5. 主要機能要件 (タブ別)

#### 5.1. テストピース (ホームタブ)
* **機能:** ユーザーが追加したテストピースをギャラリー形式で一覧表示する。
* **レイアウト:**
    * グリッド表示。列数は設定タブから変更可能（レスポンシブ対応）。
* **カードデザイン:**
    * テストピース画像、釉薬名、素地土名を表示。
* **詳細画面:**
    * **全画面画像表示:** 画像をタップして拡大、ズーム操作が可能。
    * **スポイト検索:** 画像上のスポイトアイコンから、画像内の任意の色を抽出して検索画面へ遷移可能。スポイトモード中は画像以外の領域が暗転し、選択しやすくなる。
    * **色見本:** 画像から自動抽出された代表色（スウォッチ）を表示。タップでその色を検索。

#### 5.2. 検索
* **機能:** 複合条件による高度な検索機能。
* **検索条件:**
    * **テキスト検索:** 釉薬名やタグを検索。スペース区切りでAND検索、マイナス(`-`)をつけて除外検索が可能。
    * **色検索:**
        * カラーピッカーまたはスポイト機能で選択した色に近いテストピースを検索。
        * 色差（Delta E）の閾値をスライダーで調整可能。
    * **タグ検索:** 登録済みタグから選択して絞り込み。
* **UI:**
    * 検索条件はチップとして表示され、個別に削除可能。
    * 検索結果は条件に一致するもののみ表示され、色検索時は色の近い順にソートされる。

#### 5.3. 釉薬
* **機能:**
    * 釉薬レシピの管理（CRUD）。
    * **一括インポート:** Excelファイル等から複数の釉薬データを一括登録する機能。

#### 5.4. 原料
* **機能:**
    * 釉薬調合に使用する原料の管理（CRUD）。
    * 化学成分比（ゼーゲル式計算の基礎データ）の登録。

#### 5.5. 設定
* **機能:** アプリ全体の表示設定やマスターデータの管理。
* **管理項目:**
    * **表示設定:** グリッドの列数変更。
    * **焼成プロファイル管理:** 焼成パターンの登録・編集（チャートプレビュー付き）。
    * **焼成雰囲気管理:** 酸化・還元などの区分管理。
    * **素地土管理:** 使用する土の種類の管理。
    * **アカウント:** サインアウト機能。

---

### 6. 将来実装（PoC以降）
* **類似釉薬の提案:**
    * 調合データを分析し、成分が近い釉薬を提案する機能。
* **ゼーゲル式計算:**
    * 原料の化学組成に基づき、釉薬のゼーゲル式を自動計算・表示する機能。
