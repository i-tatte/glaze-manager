# glaze-manager

## 釉薬レシピ管理アプリ 仕様書 (Flutter + Firebase)

### 1. アプリ概要
個人利用を想定した、陶芸用の釉薬（うわぐすり）レシピ管理アプリケーション。
釉薬の調合情報と焼成結果（テストピース）を関連付けて管理し、オフライン環境でも利用できることを目的とする。

### 2. 動作環境・技術スタック
* **ターゲットプラットフォーム:**
    * Windows
    * macOS
    * Android
* **オフライン対応:**
    * **必須。** オフライン時にもデータの閲覧・編集が可能で、オンライン復帰時に自動同期されること。
* **技術スタック:**
    * フロントエンド (クライアント): **Flutter (Dart)**
    * バックエンド (BaaS): **Firebase**
* **コスト要件:**
    * サーバー費用を発生させず、Firebase の無料枠（Sparkプラン）での運用を前提とする。

### 3. Firebase サービス構成案
* **Authentication (認証):**
    * ユーザー管理。Google アカウント等でログインし、全データをユーザーIDに紐付ける。

* **Cloud Firestore (データベース):**
    * **役割:** メインデータベース。オフライン同期機能を活用する。3つの主要コレクションで構成する。
    * **保存データ (コレクション):**
        * **1. 原料 (Materials):**
            * ユーザーが管理する原料マスター。
            * 格納データ: `材料名`, `化学成分比` (SiO₂, Al₂O₃などのマップ)
        * **2. 釉薬 (Glazes):**
            * 釉薬の基本レシピ。
            * 格納データ: `釉薬名`, `調合` (Materials参照IDと配合量のマップ配列), `タグ` (配列)
        * **3. テストピース (TestPieces):**
            * 釉薬の焼成結果。
            * 格納データ: `釉薬ID` (Glazes参照), `焼成温度曲線` (CSVパス等), `素地土名`, `画像パス` (Storageパス), `色味データ` (数値化済)

* **Cloud Storage (ストレージ):**
    * **役割:** `TestPieces` に紐付く、**テストピース画像**（JPEG/PNG等）のファイル保存場所。

* **Cloud Functions (サーバーレス関数):**
    * **役割:** (推奨) 画像アップロードをトリガーとしたサーバーサイド処理。
    * **処理内容:** Storage への画像アップロードをトリガーに色味データを数値化（L\*a\*b\*値など）し、Firestore の該当 `TestPieces` ドキュメントに書き込む。

---

### 4. UI/UX 設計
* **基本レイアウト:**
    * 現代風のタブレイアウトを採用する。
* **ナビゲーション:**
    * 画面下部のタブバー（Bottom Navigation Bar）により、主要機能間を遷移する。
* **タブ構成:**
    * 以下の5つのタブを基本構成とする（将来的に増減する可能性あり）。
        1.  **テストピース**
        2.  **検索**
        3.  **釉薬**
        4.  **材料**
        5.  **設定**

---

### 5. 主要機能要件 (タブ別)

#### 5.1. テストピース (ホームタブ)
* **機能:** ユーザーが追加したテストピースをギャラリー形式で一覧表示する。
* **レイアウト:**
    * カードが縦横にグリッド状に並び、画面全体を縦向きにスクロール可能。
    * 1行あたりのカード枚数（列数）は「設定」タブから変更可能。
        * **デフォルト:** 4列
        * **最大列数 (プラットフォーム依存):** Android: 10列 / PC (Windows, Mac): 20列
* **カードデザイン:**
    * 正方形のテストピース画像を表示する。
    * 画像の下に `釉薬名` と `素地名` をキャプションとして表示する。
* **操作:**
    * 各カードをタップすると、関連する釉薬の詳細画面（またはテストピース詳細画面）へ遷移する。

#### 5.2. 検索
* **UI構成:**
    * 画面上部に検索バーを配置する。
    * 検索バーの下に「最近見たテストピース」をギャラリー形式で表示する。
* **検索バーの機能:**
    * **テキスト検索:** 検索バー本体をタップするとテキスト入力モードになり、入力された文字列に基づき `釉薬名` および `タグ` を**部分一致**で検索する。
    * **色味検索:** 検索バー右部の「カラーパレットアイコン」をタップすると、カラーピッカーが起動し、選択した色に近い `色味データ` を持つ `TestPieces` を検索する。
    * **タグ検索:** 検索バー右部の「タグアイコン」をタップすると、既存のタグ一覧が開き、ユーザーが単数または複数選択したタグで **AND検索** を行う。

#### 5.3. 釉薬
* **機能:**
    * 登録済みの `Glazes`（釉薬レシピ）を管理、閲覧、新規追加する (CRUD)。
    * 一覧表示（リスト形式など）と詳細表示画面を持つ。
* **一括登録 (推奨):**
    * 特定フォーマットのCSVファイルをインポートし、複数の釉薬データを一括で `Glazes` コレクションに追加できる機能。

#### 5.4. 材料
* **機能:**
    * 登録済みの `Materials`（原料）を管理、閲覧、新規追加する (CRUD)。
    * 一覧表示と詳細表示画面（化学成分比の入力含む）を持つ。

#### 5.5. 設定
* **機能:** アプリケーション全体の動作や見た目を変更する。
* **設定項目 (例):**
    * 「テストピース」タブのデフォルト列数。
    * アプリのテーマ（ライト / ダークモード）。
    * データの同期設定など。

---

### 6. 将来実装（PoC以降）
* **類似釉薬の確認:**
    * `Glazes` の `調合` データを分析し、「ある材料1種類の配合量だけが異なる釉薬」を自動でリストアップする機能。
* **ゼーゲル式関連機能:**
    * `Materials` の化学成分比に基づき、`Glazes` のゼーゲル式を自動計算する。
    * ゼーゲル式に基づき、特定の原料を別の原料で代替する際の配合を提案する。

